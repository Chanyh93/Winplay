<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Wallet - MZ PLAY</title>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>
  <div class="nav">
    <div class="nav-inner">
      <div class="brand">MZ PLAY <span class="badge">WALLET</span></div>
      <div class="nav-links">
        <a class="pill" href="./index.html">Lobby</a>
        <a class="pill" href="./deposit.html">Deposit</a>
        <a class="pill" href="./crash.html">Crash</a>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="muted">点数余额</div>
          <div class="kpi" id="bal">0</div>
        </div>
        <div class="row">
          <button class="btn" onclick="location.href='./deposit.html'">充值</button>
          <button class="btn btn-ghost" onclick="resetDemo()">重置试玩</button>
        </div>
      </div>
      <div class="small" style="margin-top:10px">
        这版先用浏览器存储点数（演示用）。你要接“手动审核充值”后台时我再帮你升级到真正数据库。
      </div>
    </div>

    <div class="card" id="vip" style="margin-top:14px">
      <div class="h1" style="font-size:22px;margin:0">VIP & Tasks（演示）</div>
      <div class="muted">每日签到送点数，提高留存。</div>
      <div class="row" style="margin-top:12px">
        <button class="btn" onclick="daily()">每日签到 +200</button>
      </div>
      <div class="small" id="msg" style="margin-top:10px"></div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="h1" style="font-size:22px;margin:0">最近记录</div>
      <table class="table" id="logTable">
        <thead>
          <tr><th>时间</th><th>类型</th><th>变化</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="small">记录保存在浏览器本地。</div>
    </div>
  </div>

<script>
  const BAL="mz_balance";
  const LOG="mz_log";
  const SIGN="mz_last_sign";

  function nowStr(){ return new Date().toLocaleString(); }
  function getBal(){ return parseInt(localStorage.getItem(BAL)||"0",10); }
  function setBal(v){ localStorage.setItem(BAL,String(v)); document.getElementById("bal").textContent=v; }
  function addLog(type, delta){
    const arr = JSON.parse(localStorage.getItem(LOG)||"[]");
    arr.unshift({t: nowStr(), type, delta});
    localStorage.setItem(LOG, JSON.stringify(arr.slice(0,50)));
    renderLog();
  }
  function renderLog(){
    const arr = JSON.parse(localStorage.getItem(LOG)||"[]");
    const tb = document.querySelector("#logTable tbody");
    tb.innerHTML = arr.map(x=>`<tr><td>${x.t}</td><td>${x.type}</td><td>${x.delta}</td></tr>`).join("");
  }
  function ensureInit(){
    if(!localStorage.getItem(BAL)) localStorage.setItem(BAL,"5000");
    setBal(getBal());
    renderLog();
  }

  function resetDemo(){
    localStorage.setItem(BAL,"5000");
    localStorage.setItem(LOG,"[]");
    localStorage.removeItem(SIGN);
    ensureInit();
    alert("已重置为 5000 点数");
  }

  function daily(){
    const today = new Date().toDateString();
    const last = localStorage.getItem(SIGN);
    if(last === today){
      document.getElementById("msg").textContent = "今天已签到，明天再来。";
      return;
    }
    localStorage.setItem(SIGN, today);
    const b = getBal() + 200;
    setBal(b);
    addLog("Daily Sign", "+200");
    document.getElementById("msg").textContent = "签到成功 +200 点数";
  }

  ensureInit();
</script>
</body>
</html>
